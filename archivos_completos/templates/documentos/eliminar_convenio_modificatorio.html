{% extends 'base.html' %}

{% block title %}Eliminar Convenio Modificatorio - Olea Abogados{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-trash text-danger me-2"></i>
            Eliminar Convenio Modificatorio #{{ convenio.id }}
        </h1>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="alert alert-danger" role="alert">
            <h5><i class="fas fa-exclamation-triangle me-2"></i>¡Atención!</h5>
            <p class="mb-0">
                Esta acción eliminará permanentemente el convenio modificatorio y no se puede deshacer. 
                Por favor, confirma que deseas continuar.
            </p>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Información del Convenio a Eliminar
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong><i class="fas fa-hashtag me-2 text-muted"></i>ID:</strong><br>
                        #{{ convenio.id }}</p>
                        <p><strong><i class="fas fa-calendar me-2 text-primary"></i>Fecha del Convenio:</strong><br>
                        {{ convenio.fecha_convenio|date:"d/m/Y" }}</p>
                        <p><strong><i class="fas fa-map-marker-alt me-2 text-danger"></i>Lugar:</strong><br>
                        {{ convenio.lugar_convenio }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong><i class="fas fa-user-graduate me-2 text-info"></i>Estudiante:</strong><br>
                        {{ convenio.estudiante_nombre }}</p>
                        <p><strong><i class="fas fa-building me-2 text-success"></i>Inversionista:</strong><br>
                        {{ convenio.inversionista_razon_social|truncatechars:40 }}</p>
                        <p><strong><i class="fas fa-flag me-2 text-warning"></i>Estado:</strong><br>
                        <span class="badge {{ convenio.get_estado_badge_class }}">
                            {{ convenio.get_estado_display }}
                        </span></p>
                    </div>
                </div>
                
                <hr>
                
                <div class="row">
                    <div class="col-md-6">
                        <p><strong><i class="fas fa-calculator me-2 text-primary"></i>Adeudo Anterior:</strong><br>
                        ${{ convenio.adeudo_principal_anterior|floatformat:2 }}</p>
                        <p><strong><i class="fas fa-chart-line me-2 text-success"></i>Aumento:</strong><br>
                        ${{ convenio.aumento_monto|floatformat:2 }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong><i class="fas fa-dollar-sign me-2 text-warning"></i>Inversión Total:</strong><br>
                        ${{ convenio.inversion_total|floatformat:2 }}</p>
                        <p><strong><i class="fas fa-clock me-2 text-muted"></i>Creado:</strong><br>
                        {{ convenio.fecha_creacion|date:"d/m/Y H:i" }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Formulario de confirmación -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Confirmar Eliminación
                </h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <p class="text-danger">
                        <strong>¿Estás seguro de que deseas eliminar este convenio modificatorio?</strong>
                    </p>
                    <p class="text-muted">
                        Esta acción no se puede deshacer. El convenio será eliminado permanentemente 
                        de la base de datos junto con toda su información asociada.
                    </p>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'documentos:detalle_convenio_modificatorio' convenio.pk %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Cancelar
                        </a>
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash me-2"></i>Sí, Eliminar Convenio
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmación adicional -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="confirmDeleteModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Confirmación Final
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>¿Estás completamente seguro?</strong></p>
                <p>Esta acción eliminará permanentemente:</p>
                <ul>
                    <li>Convenio Modificatorio #{{ convenio.id }}</li>
                    <li>Estudiante: {{ convenio.estudiante_nombre }}</li>
                    <li>Inversión Total: ${{ convenio.inversion_total|floatformat:2 }}</li>
                    <li>Toda la información asociada</li>
                </ul>
                <p class="text-danger"><strong>Esta acción NO se puede deshacer.</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-danger" onclick="document.querySelector('form').submit();">
                    <i class="fas fa-trash me-2"></i>Eliminar Definitivamente
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Interceptar el envío del formulario para mostrar modal de confirmación
    const form = document.querySelector('form');
    const submitBtn = form.querySelector('button[type="submit"]');
    
    submitBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const modal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
        modal.show();
    });
});
</script>
{% endblock %}
