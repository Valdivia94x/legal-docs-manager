{% extends 'base.html' %}

{% block title %}Convertidor DOCX a HTML - Olea Abogados{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-file-word text-primary me-2"></i>
            Convertidor DOCX a HTML
        </h1>
        <p class="text-muted mb-4">
            Sube un archivo .docx para convertirlo a HTML usando Mammoth. 
            Esta herramienta es útil para previsualizar cómo se verán los documentos convertidos.
        </p>
    </div>
</div>

<div class="row">
    <!-- Formulario de carga -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-upload me-2"></i>
                    Cargar Archivo DOCX
                </h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="docx_file" class="form-label">Seleccionar archivo .docx</label>
                        <input type="file" 
                               class="form-control" 
                               id="docx_file" 
                               name="docx_file" 
                               accept=".docx"
                               required>
                        <div class="form-text">
                            Solo archivos .docx son permitidos (máximo 10MB)
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-magic me-2"></i>
                        Convertir a HTML
                    </button>
                </form>
                
                {% if error_message %}
                <div class="alert alert-danger mt-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    {{ error_message }}
                </div>
                {% endif %}
                
                {% if conversion_messages %}
                <div class="alert alert-warning mt-3">
                    <h6><i class="fas fa-info-circle me-2"></i>Mensajes de conversión:</h6>
                    <ul class="mb-0">
                        {% for message in conversion_messages %}
                        <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                {% if original_filename %}
                <div class="alert alert-success mt-3">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Archivo procesado:</strong> {{ original_filename }}
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Información adicional -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Información
                </h6>
            </div>
            <div class="card-body">
                <h6>¿Qué hace esta herramienta?</h6>
                <ul class="small">
                    <li>Convierte archivos .docx a HTML</li>
                    <li>Preserva el formato básico del documento</li>
                    <li>Útil para previsualizar documentos</li>
                    <li>Genera HTML limpio y estructurado</li>
                </ul>
                
                <h6 class="mt-3">Limitaciones:</h6>
                <ul class="small">
                    <li>Solo archivos .docx (no .doc)</li>
                    <li>Algunas características avanzadas pueden no convertirse</li>
                    <li>Imágenes pueden requerir procesamiento adicional</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Resultado de la conversión -->
    <div class="col-lg-8">
        {% if html_result %}
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-code me-2"></i>
                    Resultado HTML
                </h5>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleView('preview')">
                        <i class="fas fa-eye me-1"></i>Vista Previa
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleView('code')">
                        <i class="fas fa-code me-1"></i>Código HTML
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-success" onclick="copyToClipboard()">
                        <i class="fas fa-copy me-1"></i>Copiar
                    </button>
                </div>
            </div>
            <div class="card-body">
                <!-- Vista previa del HTML -->
                <div id="preview-view" class="border rounded p-3" style="min-height: 400px; max-height: 600px; overflow-y: auto;">
                    {{ html_result|safe }}
                </div>
                
                <!-- Código HTML crudo -->
                <div id="code-view" class="d-none">
                    <pre><code id="html-code" class="language-html">{{ html_result|escape }}</code></pre>
                </div>
                
                <!-- HTML oculto para copiar -->
                <textarea id="html-content" class="d-none">{{ html_result }}</textarea>
            </div>
        </div>
        {% else %}
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="fas fa-file-word fa-4x text-muted mb-3"></i>
                <h5 class="text-muted">No hay resultado aún</h5>
                <p class="text-muted">
                    Selecciona un archivo .docx y haz clic en "Convertir a HTML" para ver el resultado aquí.
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Botón para volver al dashboard -->
<div class="row mt-4">
    <div class="col-12">
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>
            Volver al Dashboard
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleView(viewType) {
    const previewView = document.getElementById('preview-view');
    const codeView = document.getElementById('code-view');
    const buttons = document.querySelectorAll('.btn-group .btn');
    
    // Remover clases activas
    buttons.forEach(btn => btn.classList.remove('active'));
    
    if (viewType === 'preview') {
        previewView.classList.remove('d-none');
        codeView.classList.add('d-none');
        buttons[0].classList.add('active');
    } else {
        previewView.classList.add('d-none');
        codeView.classList.remove('d-none');
        buttons[1].classList.add('active');
    }
}

function copyToClipboard() {
    const htmlContent = document.getElementById('html-content');
    htmlContent.select();
    htmlContent.setSelectionRange(0, 99999); // Para móviles
    
    try {
        document.execCommand('copy');
        
        // Mostrar feedback visual
        const copyBtn = document.querySelector('[onclick="copyToClipboard()"]');
        const originalText = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="fas fa-check me-1"></i>Copiado';
        copyBtn.classList.remove('btn-outline-success');
        copyBtn.classList.add('btn-success');
        
        setTimeout(() => {
            copyBtn.innerHTML = originalText;
            copyBtn.classList.remove('btn-success');
            copyBtn.classList.add('btn-outline-success');
        }, 2000);
        
    } catch (err) {
        alert('Error al copiar al portapapeles');
    }
}

// Inicializar vista previa como activa
document.addEventListener('DOMContentLoaded', function() {
    const previewBtn = document.querySelector('[onclick="toggleView(\'preview\')"]');
    if (previewBtn) {
        previewBtn.classList.add('active');
    }
});
</script>
{% endblock %}
