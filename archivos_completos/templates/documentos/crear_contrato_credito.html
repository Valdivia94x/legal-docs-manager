{% extends 'base.html' %}

{% block title %}Crear Contrato de Crédito - Olea Abogados{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-credit-card text-primary me-2"></i>
            Crear Contrato de Crédito
        </h1>
    </div>
</div>

<div class="row">
    <!-- Formulario -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-wpforms me-2"></i>
                    Información del Contrato de Crédito
                </h5>
            </div>
            <div class="card-body">
                <form method="post" id="documento-form">
                    {% csrf_token %}
                    
                    <!-- Campos ocultos para campos obligatorios no mostrados -->
                    <div style="display: none;">
                        {{ form.acreditante_deed_constitucion_numero }}
                        {{ form.acreditante_deed_constitucion_fecha }}
                        {{ form.acreditante_notario_constitucion }}
                        {{ form.acreditante_registro_constitucion_folio }}
                        {{ form.acreditante_deed_prom_inv_numero }}
                        {{ form.acreditante_deed_prom_inv_fecha }}
                        {{ form.acreditante_notario_prom_inv }}
                        {{ form.acreditante_registro_prom_inv_folio }}
                        {{ form.acreditante_deed_poder_numero }}
                        {{ form.acreditante_deed_poder_fecha }}
                        {{ form.acreditante_notario_poder }}
                        {{ form.acreditado_deed_constitucion_original_numero }}
                        {{ form.acreditado_deed_constitucion_original_fecha }}
                        {{ form.acreditado_notario_constitucion_original }}
                        {{ form.acreditado_registro_constitucion_original_folio }}
                        {{ form.acreditado_deed_denominacion_cambio_numero }}
                        {{ form.acreditado_deed_denominacion_cambio_fecha }}
                        {{ form.acreditado_notario_denominacion_cambio }}
                        {{ form.acreditado_registro_denominacion_cambio_folio }}
                        {{ form.acreditado_deed_poder_numero }}
                        {{ form.acreditado_deed_poder_fecha }}
                        {{ form.acreditado_notario_poder }}
                        {{ form.acreditado_resoluciones_unani_fecha }}
                        {{ form.jurisdiccion }}
                        {{ form.ley_aplicable }}
                    </div>
                    
                    <!-- Mostrar errores del formulario -->
                    {% if form.errors %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Errores en el formulario:</h6>
                            <ul class="mb-0">
                                {% for field, errors in form.errors.items %}
                                    {% for error in errors %}
                                        <li><strong>{{ field }}:</strong> {{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endif %}
                    
                    <!-- Información General del Contrato -->
                    <h6 class="text-primary mb-3"><i class="fas fa-info-circle me-2"></i>Información General</h6>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.fecha_contrato.id_for_label }}" class="form-label">{{ form.fecha_contrato.label }}</label>
                            {{ form.fecha_contrato }}
                            {% if form.fecha_contrato.help_text %}
                                <div class="form-text">{{ form.fecha_contrato.help_text }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.lugar_contrato.id_for_label }}" class="form-label">{{ form.lugar_contrato.label }}</label>
                            {{ form.lugar_contrato }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="{{ form.estado.id_for_label }}" class="form-label">{{ form.estado.label }}</label>
                            {{ form.estado }}
                        </div>
                    </div>

                    <!-- Información del Acreditante -->
                    <h6 class="text-primary mb-3"><i class="fas fa-building me-2"></i>Acreditante</h6>
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <label for="{{ form.acreditante_razon_social.id_for_label }}" class="form-label">{{ form.acreditante_razon_social.label }}</label>
                            {{ form.acreditante_razon_social }}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.acreditante_forma_legal.id_for_label }}" class="form-label">{{ form.acreditante_forma_legal.label }}</label>
                            {{ form.acreditante_forma_legal }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="{{ form.acreditante_representante.id_for_label }}" class="form-label">{{ form.acreditante_representante.label }}</label>
                            {{ form.acreditante_representante }}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.domicilio_acreditante.id_for_label }}" class="form-label">{{ form.domicilio_acreditante.label }}</label>
                        {{ form.domicilio_acreditante }}
                    </div>

                    <!-- Información del Acreditado -->
                    <h6 class="text-primary mb-3"><i class="fas fa-user-tie me-2"></i>Acreditado</h6>
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="{{ form.acreditado_razon_social_original.id_for_label }}" class="form-label">{{ form.acreditado_razon_social_original.label }}</label>
                            {{ form.acreditado_razon_social_original }}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.domicilio_acreditado.id_for_label }}" class="form-label">{{ form.domicilio_acreditado.label }}</label>
                        {{ form.domicilio_acreditado }}
                    </div>

                    <!-- Términos del Crédito -->
                    <h6 class="text-primary mb-3"><i class="fas fa-dollar-sign me-2"></i>Términos del Crédito</h6>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.monto_credito.id_for_label }}" class="form-label">{{ form.monto_credito.label }}</label>
                            {{ form.monto_credito }}
                            {% if form.monto_credito.help_text %}
                                <div class="form-text">{{ form.monto_credito.help_text }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.monto_credito_texto.id_for_label }}" class="form-label">{{ form.monto_credito_texto.label }}</label>
                            {{ form.monto_credito_texto }}
                            {% if form.monto_credito_texto.help_text %}
                                <div class="form-text">{{ form.monto_credito_texto.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="{{ form.tasa_interes_ordinaria.id_for_label }}" class="form-label">{{ form.tasa_interes_ordinaria.label }}</label>
                            {{ form.tasa_interes_ordinaria }}
                            {% if form.tasa_interes_ordinaria.help_text %}
                                <div class="form-text">{{ form.tasa_interes_ordinaria.help_text }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.tasa_interes_moratoria.id_for_label }}" class="form-label">{{ form.tasa_interes_moratoria.label }}</label>
                            {{ form.tasa_interes_moratoria }}
                            {% if form.tasa_interes_moratoria.help_text %}
                                <div class="form-text">{{ form.tasa_interes_moratoria.help_text }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.plazo_credito_fecha_vencimiento.id_for_label }}" class="form-label">{{ form.plazo_credito_fecha_vencimiento.label }}</label>
                            {{ form.plazo_credito_fecha_vencimiento }}
                            {% if form.plazo_credito_fecha_vencimiento.help_text %}
                                <div class="form-text">{{ form.plazo_credito_fecha_vencimiento.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Disposiciones del Crédito -->
                    <h6 class="text-primary mb-3"><i class="fas fa-calendar-alt me-2"></i>Disposiciones del Crédito</h6>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="{{ form.numero_disposiciones.id_for_label }}" class="form-label">{{ form.numero_disposiciones.label }}</label>
                            {{ form.numero_disposiciones }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.disposicion1_fecha.id_for_label }}" class="form-label">Fecha Disposición 1</label>
                            {{ form.disposicion1_fecha }}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.disposicion1_importe.id_for_label }}" class="form-label">Importe Disposición 1</label>
                            {{ form.disposicion1_importe }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.disposicion2_fecha.id_for_label }}" class="form-label">Fecha Disposición 2</label>
                            {{ form.disposicion2_fecha }}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.disposicion2_importe.id_for_label }}" class="form-label">Importe Disposición 2</label>
                            {{ form.disposicion2_importe }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.disposicion3_fecha.id_for_label }}" class="form-label">Fecha Disposición 3</label>
                            {{ form.disposicion3_fecha }}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.disposicion3_importe.id_for_label }}" class="form-label">Importe Disposición 3</label>
                            {{ form.disposicion3_importe }}
                        </div>
                    </div>

                    <!-- Fechas de Pago -->
                    <h6 class="text-primary mb-3"><i class="fas fa-calendar-check me-2"></i>Fechas de Pago</h6>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="{{ form.pagos_intereses_fecha1.id_for_label }}" class="form-label">Pago Intereses 1</label>
                            {{ form.pagos_intereses_fecha1 }}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.pagos_intereses_fecha2.id_for_label }}" class="form-label">Pago Intereses 2</label>
                            {{ form.pagos_intereses_fecha2 }}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.pagos_intereses_fecha3.id_for_label }}" class="form-label">Pago Intereses 3</label>
                            {{ form.pagos_intereses_fecha3 }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.pago_principal_fecha.id_for_label }}" class="form-label">{{ form.pago_principal_fecha.label }}</label>
                            {{ form.pago_principal_fecha }}
                            {% if form.pago_principal_fecha.help_text %}
                                <div class="form-text">{{ form.pago_principal_fecha.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Información Bancaria -->
                    <h6 class="text-primary mb-3"><i class="fas fa-university me-2"></i>Información Bancaria</h6>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.banco_nombre.id_for_label }}" class="form-label">{{ form.banco_nombre.label }}</label>
                            {{ form.banco_nombre }}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.banco_titular.id_for_label }}" class="form-label">{{ form.banco_titular.label }}</label>
                            {{ form.banco_titular }}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.banco_cuenta_numero.id_for_label }}" class="form-label">{{ form.banco_cuenta_numero.label }}</label>
                            {{ form.banco_cuenta_numero }}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.banco_clabe.id_for_label }}" class="form-label">{{ form.banco_clabe.label }}</label>
                            {{ form.banco_clabe }}
                        </div>
                    </div>

                    <!-- Información del Aval -->
                    <h6 class="text-primary mb-3"><i class="fas fa-user-shield me-2"></i>Información del Aval</h6>
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="{{ form.aval_nombre.id_for_label }}" class="form-label">{{ form.aval_nombre.label }}</label>
                            {{ form.aval_nombre }}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.aval_domicilio.id_for_label }}" class="form-label">{{ form.aval_domicilio.label }}</label>
                        {{ form.aval_domicilio }}
                    </div>

                    <!-- Botones -->
                    <div class="d-flex justify-content-between">
                        <div>
                            <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Cancelar
                            </a>
                            <button type="button" class="btn btn-info ms-2" id="cargar-ejemplo">
                                <i class="fas fa-magic me-2"></i>Cargar Ejemplo
                            </button>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Guardar Contrato
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Configurar datepickers
    const dateInputs = document.querySelectorAll('input[type="date"]');
    dateInputs.forEach(input => {
        if (!input.value) {
            input.value = new Date().toISOString().split('T')[0];
        }
    });
    
    // Función para cargar datos de ejemplo
    document.getElementById('cargar-ejemplo').addEventListener('click', function() {
        // Información General
        document.getElementById('id_fecha_contrato').value = '2024-01-15';
        document.getElementById('id_lugar_contrato').value = 'Ciudad de México';
        document.getElementById('id_estado').value = 'borrador';
        
        // Acreditante
        document.getElementById('id_acreditante_razon_social').value = 'Financiera Ejemplo S.A.P.I. de C.V.';
        document.getElementById('id_acreditante_forma_legal').value = 'S.A.P.I. de C.V.';
        document.getElementById('id_acreditante_representante').value = 'Lic. María González Pérez';
        document.getElementById('id_domicilio_acreditante').value = 'Av. Reforma 123, Col. Centro, C.P. 06000, Ciudad de México, CDMX';
        
        // Acreditado
        document.getElementById('id_acreditado_razon_social_original').value = 'Empresa Solicitante S.A. de C.V.';
        document.getElementById('id_domicilio_acreditado').value = 'Calle Principal 456, Col. Industrial, C.P. 54000, Tlalnepantla, Estado de México';
        
        // Términos del Crédito
        document.getElementById('id_monto_credito').value = '5000000.00';
        document.getElementById('id_monto_credito_texto').value = 'Cinco millones de pesos 00/100 Moneda Nacional';
        document.getElementById('id_tasa_interes_ordinaria').value = '18.50';
        document.getElementById('id_tasa_interes_moratoria').value = '24.00';
        document.getElementById('id_plazo_credito_fecha_vencimiento').value = '2025-01-15';
        
        // Disposiciones del Crédito
        document.getElementById('id_numero_disposiciones').value = '3';
        document.getElementById('id_disposicion1_fecha').value = '2024-02-01';
        document.getElementById('id_disposicion1_importe').value = '2000000.00';
        document.getElementById('id_disposicion2_fecha').value = '2024-05-01';
        document.getElementById('id_disposicion2_importe').value = '1500000.00';
        document.getElementById('id_disposicion3_fecha').value = '2024-08-01';
        document.getElementById('id_disposicion3_importe').value = '1500000.00';
        
        // Fechas de Pago
        document.getElementById('id_pagos_intereses_fecha1').value = '2024-04-15';
        document.getElementById('id_pagos_intereses_fecha2').value = '2024-07-15';
        document.getElementById('id_pagos_intereses_fecha3').value = '2024-10-15';
        document.getElementById('id_pago_principal_fecha').value = '2025-01-15';
        
        // Información Bancaria
        document.getElementById('id_banco_nombre').value = 'BBVA México';
        document.getElementById('id_banco_titular').value = 'Financiera Ejemplo S.A.P.I. de C.V.';
        document.getElementById('id_banco_cuenta_numero').value = '0123456789';
        document.getElementById('id_banco_clabe').value = '012345678901234567';
        
        // Información del Aval
        document.getElementById('id_aval_nombre').value = 'Ing. Carlos Rodríguez López';
        document.getElementById('id_aval_domicilio').value = 'Av. Universidad 789, Col. Del Valle, C.P. 03100, Ciudad de México, CDMX';
        
        // Función auxiliar para llenar campos que pueden no existir
        function setFieldIfExists(fieldId, value) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.value = value;
            }
        }
        
        // Campos obligatorios que pueden no estar en el template
        setFieldIfExists('id_jurisdiccion', 'Tribunales de la Ciudad de México');
        setFieldIfExists('id_ley_aplicable', 'Leyes de los Estados Unidos Mexicanos');
        setFieldIfExists('id_acreditante_deed_constitucion_numero', '12345');
        setFieldIfExists('id_acreditante_deed_constitucion_fecha', '2020-01-15');
        setFieldIfExists('id_acreditante_notario_constitucion', 'Lic. Juan Pérez Notario Público No. 123');
        setFieldIfExists('id_acreditante_registro_constitucion_folio', 'FOLIO-001');
        setFieldIfExists('id_acreditante_deed_prom_inv_numero', '12346');
        setFieldIfExists('id_acreditante_deed_prom_inv_fecha', '2021-01-15');
        setFieldIfExists('id_acreditante_notario_prom_inv', 'Lic. Juan Pérez Notario Público No. 123');
        setFieldIfExists('id_acreditante_registro_prom_inv_folio', 'FOLIO-002');
        setFieldIfExists('id_acreditante_deed_poder_numero', '12347');
        setFieldIfExists('id_acreditante_deed_poder_fecha', '2023-01-15');
        setFieldIfExists('id_acreditante_notario_poder', 'Lic. Juan Pérez Notario Público No. 123');
        setFieldIfExists('id_acreditado_deed_constitucion_original_numero', '54321');
        setFieldIfExists('id_acreditado_deed_constitucion_original_fecha', '2019-05-10');
        setFieldIfExists('id_acreditado_notario_constitucion_original', 'Lic. Ana López Notario Público No. 456');
        setFieldIfExists('id_acreditado_registro_constitucion_original_folio', 'FOLIO-003');
        setFieldIfExists('id_acreditado_deed_denominacion_cambio_numero', '54322');
        setFieldIfExists('id_acreditado_deed_denominacion_cambio_fecha', '2020-05-10');
        setFieldIfExists('id_acreditado_notario_denominacion_cambio', 'Lic. Ana López Notario Público No. 456');
        setFieldIfExists('id_acreditado_registro_denominacion_cambio_folio', 'FOLIO-004');
        setFieldIfExists('id_acreditado_deed_poder_numero', '54323');
        setFieldIfExists('id_acreditado_deed_poder_fecha', '2023-05-10');
        setFieldIfExists('id_acreditado_notario_poder', 'Lic. Ana López Notario Público No. 456');
        setFieldIfExists('id_acreditado_resoluciones_unani_fecha', '2023-12-15');
        
        // Mostrar mensaje de confirmación
        const toast = document.createElement('div');
        toast.className = 'alert alert-success alert-dismissible fade show position-fixed';
        toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        toast.innerHTML = `
            <i class="fas fa-check-circle me-2"></i>
            Datos de ejemplo cargados exitosamente
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(toast);
        
        // Auto-remover el toast después de 3 segundos
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 3000);
    });
});
</script>
{% endblock %}
